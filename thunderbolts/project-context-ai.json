{
  "jsconfig.json": "{\n  \"compilerOptions\": {\n    \"paths\": {\n      \"@/*\": [\"./src/*\"]\n    }\n  }\n}\n",
  "package-lock.json": "{\n  \"name\": \"thunderbolts\",\n  \"version\": \"0.1.0\",\n  \"lockfileVersion\": 3,\n  \"requires\": true,\n  \"packages\": {\n    \"\": {\n      \"name\": \"thunderbolts\",\n      \"version\": \"0.1.0\",\n      \"dependencies\": {\n        \"@auth/mongodb-adapter\": \"^3.11.1\",\n        \"bcryptjs\": \"^3.0.3\",\n        \"lucide-react\": \"^0.563.0\",\n        \"mongodb\": \"^6.21.0\",\n        \"mongoose\": \"^9.1.5\",\n        \"next\": \"16.1.6\",\n        \"next-auth\": \"^4.24.13\",\n        \"react\": \"19.2.3\",\n        \"react-dom\": \"19.2.3\"\n      },\n      \"devDependencies\": {\n        \"@tailwindcss/postcss\": \"^4\",\n        \"eslint\": \"^9\",\n        \"eslint-config-next\": \"16.1.6\",\n        \"tailwindcss\": \"^4\"\n      }\n    },\n    \"node_modules/@alloc/quick-lru\": {\n      \"version\": \"5.2.0\",\n      \"resolved\": \"https://registry.npmjs.org/@alloc/quick-lru/-/quick-lru-5.2.0.tgz\",\n      \"integrity\": \"sha512-UrcABB+4bUrFABwbluTIBErXwvbsU/V7TZWfmbgJfbkwiBuziS9gxdODUyuiecfdGQ85jglMW6juS3+z5TsKLw==\",\n      \"dev\": true,\n      \"license\": \"MIT\",\n      \"engines\": {\n        \"node\": \">=10\"\n      },\n      \"funding\": {\n        \"url\": \"https://github.com/sponsors/sindresorhus\"\n      }\n    },\n    \"node_modules/@auth/core\": {\n      \"version\": \"0.34.3\",\n      \"resolved\": \"https://registry.npmjs.org/@auth/core/-/core-0.34.3.tgz\",\n      \"integrity\": \"sha512-jMjY/S0doZnWYNV90x0jmU3B+UcrsfGYnukxYrRbj0CVvGI/MX3JbHsxSrx2d4mbnXaUsqJmAcDfoQWA6r0lOw==\",\n      \"license\": \"ISC\",\n      \"optional\": true,\n      \"peer\": true,\n      \"dependencies\": {\n        \"@panva/hkdf\": \"^1.1.1\",\n        \"@types/cookie\": \"0.6.0\",\n        \"cookie\": \"0.6.0\",\n        \"jose\": \"^5.1.3\",\n        \"oauth4webapi\": \"^2.10.4\",\n        \"preact\": \"10.11.3\",\n        \"preact-render-to-string\": \"5.2.3\"\n      },\n      \"peerDependencies\": {\n        \"@simplewebauthn/browser\": \"^9.0.1\",\n        \"@simplewebauthn/server\": \"^9.0.2\",\n        \"nodemailer\": \"^7\"\n      },\n      \"peerDependenciesMeta\": {\n        \"@simplewebauthn/browser\": {\n          \"optional\": true\n        },\n        \"@simplewebauthn/server\": {\n          \"optional\": true\n        },\n        \"nodemailer\": {\n          \"optional\": true\n        }\n      }\n    },\n    \"node_modules/@auth/core/node_modules/cookie\": {\n      \"version\": \"0.6.0\",\n      \"resolved\": \"https://registry.npmjs.org/cookie/-/cookie-0.6.0.tgz\",\n      \"integrity\": \"sha512-U71cyTamuh1CRNCfpGY6to28lxvNwPG4Guz/EVjgf3Jmzv0vlDp1atT9eS5dDjMYHucpHbWns6Lwf3BKz6svdw==\",\n      \"license\": \"MIT\",\n      \"optional\": true,\n      \"peer\": true,\n      \"engines\": {\n        \"node\": \">= 0.6\"\n      }\n    },\n    \"node_modules/@auth/core/node_modules/jose\": {\n      \"version\": \"5.10.0\",\n      \"resolved\": \"https://registry.npmjs.org/jose/-/jose-5.10.0.tgz\",\n      \"integrity\": \"sha512-s+3Al/p9g32Iq+oqXxkW//7jk2Vig6FF1CFqzVXoTUXt2qz89YWbL+OwS17NFYEvxC35n0FKeGO2LGYSxeM2Gg==\",\n      \"license\": \"MIT\",\n      \"optional\": true,\n      \"peer\": true,\n      \"funding\": {\n        \"url\": \"https://github.com/sponsors/panva\"\n      }\n    },\n    \"node_modules/@auth/core/node_modules/preact\": {\n      \"version\": \"10.11.3\",\n      \"resolved\": \"https://registry.npmjs.org/preact/-/preact-10.11.3.tgz\",\n      \"integrity\": \"sha512-eY93IVpod/zG3uMF22Unl8h9KkrcKIRs2EGar8hwLZZDU1lkjph303V9HZBwufh2s736U6VXuhD109LYqPoffg==\",\n      \"license\": \"MIT\",\n      \"optional\": true,\n      \"peer\": true,\n      \"funding\": {\n        \"type\": \"opencollective\",\n        \"url\": \"https://opencollective.com/preact\"\n      }\n    },\n    \"node_modules/@auth/core/node_modules/preact-render-to-string\": {\n      \"version\": \"5.2.3\",\n      \"resolved\": \"https://registry.npmjs.org/preact-render-to-string/-/preact-render-to-string-5.2.3.tgz\",\n      \"integrity\": \"sha512-aPDxUn5o3GhWdtJtW0svRC2SS/l8D9MAgo2+AWml+BhDImb27ALf04Q2d+AHqUUOc6RdSXFIBVa2gxzgMKgtZA==\",\n      \"license\": \"MIT\",\n      \"optional\": true,\n      \"peer\": true,\n      \"dependencies\": {\n        \"pretty-format\": \"^3.8.0\"\n      },\n      \"peerDependencies\": {\n        \"preact\": \">=10\"\n      }\n    },\n    \"node_modules/@auth/mongodb-adapter\": {\n      \"version\": \"3.11.1\",\n      \"resolved\": \"https://registry.npmjs.org/@auth/mongodb-adapter/-/mongodb-adapter-3.11.1.tgz\",\n      \"integrity\": \"sha512-xY+VUkC3CNXct8UwQgBAQqXASqolSlIARg6oAm1378CtRN2650tQUCOEnGLNLmroVefUeP73M6t+TpGXq72vwQ==\",\n      \"license\": \"ISC\",\n      \"dependencies\": {\n        \"@auth/core\": \"0.41.1\"\n      },\n      \"peerDependencies\": {\n        \"mongodb\": \"^6\"\n      }\n    },\n    \"node_modules/@auth/mongodb-adapter/node_modules/@auth/core\": {\n      \"version\": \"0.41.1\",\n      \"resolved\": \"https://registry.npmjs.org/@auth/core/-/core-0.41.1.tgz\",\n      \"integrity\": \"sha512-t9cJ2zNYAdWMacGRMT6+r4xr1uybIdmYa49calBPeTqwgAFPV/88ac9TEvCR85pvATiSPt8VaNf+Gt24JIT/uw==\",\n      \"license\": \"ISC\",\n      \"dependencies\": {\n        \"@panva/hkdf\": \"^1.2.1\",\n        \"jose\": \"^6.0.6\",\n        \"oauth4webapi\": \"^3.3.0\",\n        \"preact\": \"10.24.3\",\n        \"preact-render-to-string\": \"6.5.11\"\n      },\n      \"peerDependencies\": {\n        \"@simplewebauthn/browser\": \"^9.0.1\",\n        \"@simplewebauthn/server\": \"^9.0.2\",\n        \"nodemailer\": \"^7.0.7\"\n      },\n      \"peerDependenciesMeta\": {\n        \"@simplewebauthn/browser\": {\n          \"optional\": true\n        },\n        \"@simplewebauthn/server\": {\n          \"optional\": true\n        },\n        \"nodemailer\": {\n          \"optional\": true\n        }\n      }\n    },\n    \"node_modules/@auth/mongodb-adapter/node_modules/jose\": {\n      \"version\": \"6.1.3\",\n      \"resolved\": \"https://registry.npmjs.org/jose/-/jose-6.1.3.tgz\",\n      \"integrity\": \"sha512-0TpaTfihd4QMNwrz/ob2Bp7X04yuxJkjRGi4aKmOqwhov54i6u79oCv7T+C7lo70MKH6BesI3vscD1yb/yzKXQ==\",\n      \"license\": \"MIT\",\n      \"funding\": {\n        \"url\": \"https://github.com/sponsors/panva\"\n      }\n    },\n    \"node_modules/@auth/mongodb-adapter/node_modules/oauth4webapi\": {\n      \"version\": \"3.8.3\",\n      \"resolved\": \"https://registry.npmjs.org/oauth4webapi/-/oauth4webapi-3.8.3.tgz\",\n      \"integrity\": \"sha512-pQ5BsX3QRTgnt5HxgHwgunIRaDXBdkT23tf8dfzmtTIL2LTpdmxgbpbBm0VgFWAIDlezQvQCTgnVIUmHupXHxw==\",\n      \"license\": \"MIT\",\n\n\n// ✂️ Truncated for AI (original 247786 characters)",
  "package.json": "{\n  \"name\": \"thunderbolts\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"next dev\",\n    \"build\": \"next build\",\n    \"start\": \"next start\",\n    \"lint\": \"eslint\"\n  },\n  \"dependencies\": {\n    \"@auth/mongodb-adapter\": \"^3.11.1\",\n    \"bcryptjs\": \"^3.0.3\",\n    \"lucide-react\": \"^0.563.0\",\n    \"mongodb\": \"^6.21.0\",\n    \"mongoose\": \"^9.1.5\",\n    \"next\": \"16.1.6\",\n    \"next-auth\": \"^4.24.13\",\n    \"react\": \"19.2.3\",\n    \"react-dom\": \"19.2.3\"\n  },\n  \"devDependencies\": {\n    \"@tailwindcss/postcss\": \"^4\",\n    \"eslint\": \"^9\",\n    \"eslint-config-next\": \"16.1.6\",\n    \"tailwindcss\": \"^4\"\n  }\n}\n",
  "project-context-ai.json": "{}",
  "src\\app\\(auth)\\log-in\\page.js": "\"use client\";\r\nimport React, { useState } from 'react';\r\nimport { signIn } from 'next-auth/react';\r\nimport { useRouter } from 'next/navigation';\r\n\r\nexport default function LoginPage() {\r\n  const router = useRouter();\r\n  const [role, setRole] = useState('donor'); // 'donor' or 'ngo'\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  const [formData, setFormData] = useState({\r\n    email: \"\",\r\n    password: \"\",\r\n  });\r\n\r\n const handleSubmit = async (e) => {\r\n  e.preventDefault();\r\n  setLoading(true);\r\n  setError(\"\");\r\n\r\n  try {\r\n    const result = await signIn(\"credentials\", {\r\n  redirect: false,\r\n  email: formData.email,\r\n  password: formData.password,\r\n  // role: role,   ← removed!\r\n});\r\n\r\n    if (result?.error) {\r\n      // result.error contains the string returned from your authorize function\r\n      setError(result.error === \"CredentialsSignin\" ? \"Invalid email or password\" : result.error);\r\n    } else {\r\n      // Force a hard refresh to ensure the session is picked up by the layout\r\n      window.location.href = role === 'donor' ? '/donor' : '/organisation';\r\n    }\r\n  } catch (err) {\r\n    setError(\"An unexpected error occurred.\");\r\n  } finally {\r\n    setLoading(false);\r\n  }\r\n};\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-white text-slate-900 font-sans\">\r\n      <div className=\"w-full max-w-md p-8 border border-slate-200\">\r\n        {/* Header */}\r\n        <div className=\"mb-10 text-center\">\r\n          <h1 className=\"text-2xl font-bold tracking-tight uppercase\">FoodLink Login</h1>\r\n          <p className=\"text-sm text-slate-500 mt-2\">Team ThunderBolts • Problem CS01SW</p>\r\n        </div>\r\n\r\n        {/* Role Selection */}\r\n        <div className=\"flex mb-8 border border-slate-900\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setRole('donor')}\r\n            className={`flex-1 py-3 text-sm font-bold transition-colors ${\r\n              role === 'donor' ? 'bg-slate-900 text-white' : 'bg-transparent text-slate-900 hover:bg-slate-50'\r\n            }`}\r\n          >\r\n            DONOR\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setRole('ngo')}\r\n            className={`flex-1 py-3 text-sm font-bold transition-colors ${\r\n              role === 'ngo' ? 'bg-slate-900 text-white' : 'bg-transparent text-slate-900 hover:bg-slate-50'\r\n            }`}\r\n          >\r\n            NGO\r\n          </button>\r\n        </div>\r\n\r\n        {/* Error Message */}\r\n        {error && (\r\n          <div className=\"mb-6 p-3 bg-red-50 border-l-4 border-red-500 text-red-700 text-xs font-bold uppercase\">\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        {/* Form */}\r\n        <form className=\"space-y-6\" onSubmit={handleSubmit}>\r\n          <div>\r\n            <label className=\"block text-xs font-bold uppercase tracking-wider mb-2\">Email Address</label>\r\n            <input \r\n              required\r\n              type=\"email\" \r\n              placeholder=\"email@example.com\"\r\n              value={formData.email}\r\n              onChange={(e) => setFormData({...formData, email: e.target.value})}\r\n              className=\"w-full px-4 py-3 border border-slate-300 focus:border-slate-900 focus:outline-none transition-colors\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-xs font-bold uppercase tracking-wider mb-2\">Password</label>\r\n            <input \r\n              required\r\n              type=\"password\" \r\n              placeholder=\"••••••••\"\r\n              value={formData.password}\r\n              onChange={(e) => setFormData({...formData, password: e.target.value})}\r\n              className=\"w-full px-4 py-3 border border-slate-300 focus:border-slate-900 focus:outline-none transition-colors\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between text-xs font-medium\">\r\n            <label className=\"flex items-center space-x-2 cursor-pointer\">\r\n              <input type=\"checkbox\" className=\"w-4 h-4 border-slate-900 rounded-none accent-slate-900\" />\r\n              <span>Remember me</span>\r\n            </label>\r\n            <a href=\"#\" className=\"underline hover:text-emerald-600 transition\">Forgot Password?</a>\r\n          </div>\r\n\r\n          <button \r\n            type=\"submit\"\r\n            disabled={loading}\r\n            className={`w-full py-4 font-bold uppercase tracking-widest transition-colors ${\r\n              loading ? 'bg-slate-400 cursor-not-allowed' : 'bg-emerald-600 hover:bg-emerald-700'\r\n            } text-white`}\r\n          >\r\n            {loading ? \"Authenticating...\" : `Sign In as ${role}`}\r\n          </button>\r\n        </form>\r\n\r\n        {/* Footer Link */}\r\n        <div className=\"mt-8 text-center text-sm\">\r\n          <span className=\"text-slate-500\">New to FoodLink? </span>\r\n          <a href=\"/register\" className=\"font-bold underline hover:text-emerald-600 transition\">Create Account</a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}",
  "src\\app\\(auth)\\register\\page.js": "\"use client\";\r\nimport React, { useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { registerUser } from '@/features/auth/actions';\r\n\r\nexport default function RegisterPage() {\r\n  const router = useRouter();\r\n  const [role, setRole] = useState('donor');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    const formData = new FormData(e.target);\r\n    const data = Object.fromEntries(formData.entries());\r\n    data.role = role;\r\n\r\n    const result = await registerUser(data);\r\n    if (result.success) {\r\n      router.push('/log-in?registered=true');\r\n    } else {\r\n      setError(result.error);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen py-12 flex items-center justify-center bg-white text-slate-900 font-sans\">\r\n      <div className=\"w-full max-w-2xl p-8 border border-slate-200\">\r\n        <div className=\"mb-10 text-center\">\r\n          <h1 className=\"text-2xl font-bold tracking-tight uppercase\">Create Account</h1>\r\n          <p className=\"text-sm text-slate-500 mt-2\">Join Team ThunderBolts FoodLink Network</p>\r\n        </div>\r\n\r\n        <div className=\"flex mb-8 border border-slate-900\">\r\n          <button type=\"button\" onClick={() => setRole('donor')} className={`flex-1 py-3 text-sm font-bold ${role === 'donor' ? 'bg-slate-900 text-white' : ''}`}>DONOR</button>\r\n          <button type=\"button\" onClick={() => setRole('ngo')} className={`flex-1 py-3 text-sm font-bold ${role === 'ngo' ? 'bg-slate-900 text-white' : ''}`}>NGO</button>\r\n        </div>\r\n\r\n        {error && <div className=\"mb-6 p-3 bg-red-50 border-l-4 border-red-500 text-red-700 text-xs font-bold uppercase\">{error}</div>}\r\n\r\n        <form className=\"space-y-6\" onSubmit={handleSubmit}>\r\n          {/* Base Credentials */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <input name=\"email\" required type=\"email\" placeholder=\"Email Address\" className=\"w-full px-4 py-3 border border-slate-300 focus:border-slate-900 outline-none\" />\r\n            <input name=\"password\" required type=\"password\" placeholder=\"Password\" className=\"w-full px-4 py-3 border border-slate-300 focus:border-slate-900 outline-none\" />\r\n          </div>\r\n\r\n          <hr className=\"border-slate-100\" />\r\n\r\n          {role === 'donor' ? (\r\n            <div className=\"space-y-4\">\r\n              <h3 className=\"font-bold text-xs uppercase tracking-widest text-emerald-600\">Donor Profile</h3>\r\n              <input name=\"name\" required placeholder=\"Full Name / Business Name\" className=\"w-full px-4 py-3 border border-slate-300 outline-none\" />\r\n              <select name=\"donorType\" className=\"w-full px-4 py-3 border border-slate-300 outline-none\">\r\n                <option value=\"Individual\">Individual</option>\r\n                <option value=\"Restaurant\">Restaurant</option>\r\n                <option value=\"Hotel\">Hotel</option>\r\n              </select>\r\n              <input name=\"phoneNumber\" required placeholder=\"Contact Number\" className=\"w-full px-4 py-3 border border-slate-300 outline-none\" />\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              <h3 className=\"font-bold text-xs uppercase tracking-widest text-emerald-600\">NGO Verification Form</h3>\r\n              <input name=\"ngoName\" required placeholder=\"Official NGO Name\" className=\"w-full px-4 py-3 border border-slate-300 outline-none\" />\r\n              \r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <select name=\"ngoType\" className=\"w-full px-4 py-3 border border-slate-300 outline-none\">\r\n                  <option value=\"\">Type of NGO</option>\r\n                  <option value=\"Food Bank\">Food Bank</option>\r\n                  <option value=\"Orphanage\">Orphanage</option>\r\n                  <option value=\"Shelter Home\">Shelter Home</option>\r\n                </select>\r\n                <select name=\"registrationType\" className=\"w-full px-4 py-3 border border-slate-300 outline-none\">\r\n                  <option value=\"\">Registration Type</option>\r\n                  <option value=\"Society\">Society</option>\r\n                  <option value=\"Trust\">Trust</option>\r\n                  <option value=\"Section 8 Company\">Section 8 Company</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <input name=\"registrationNumber\" required placeholder=\"Reg. Number\" className=\"w-full px-4 py-3 border border-slate-300 outline-none\" />\r\n                <input name=\"ngoDarpanId\" placeholder=\"NGO Darpan ID\" className=\"w-full px-4 py-3 border border-slate-300 outline-none\" />\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <input name=\"reg12A\" placeholder=\"12A Number\" className=\"w-full px-4 py-3 border border-slate-300 outline-none\" />\r\n                <input name=\"reg80G\" placeholder=\"80G Certificate Number\" className=\"w-full px-4 py-3 border border-slate-300 outline-none\" />\r\n              </div>\r\n\r\n              <textarea name=\"address\" required placeholder=\"Full Address with PIN Code\" className=\"w-full px-4 py-3 border border-slate-300 outline-none h-24\" />\r\n              <input name=\"beneficiaryCapacity\" type=\"number\" placeholder=\"Beneficiary Capacity (e.g. 100)\" className=\"w-full px-4 py-3 border border-slate-300 outline-none\" />\r\n            </div>\r\n          )}\r\n\r\n          <button type=\"submit\" disabled={loading} className=\"w-full bg-emerald-600 text-white py-4 font-bold uppercase tracking-widest hover:bg-emerald-700 transition-colors\">\r\n            {loading ? \"Processing...\" : `Register as ${role}`}\r\n          </button>\r\n        </form>\r\n         {/* Footer Link */}\r\n        <div className=\"mt-8 text-center text-sm\">\r\n          <span className=\"text-slate-500\">Already been to F\n\n// ✂️ Truncated for AI (original 6174 characters)",
  "src\\app\\(donor)\\donor\\page.js": "import React from \"react\";\r\nimport connectDB from \"@/lib/db\";\r\nimport User from \"@/models/User\";\r\nimport Listing from \"@/models/Listing\"; // 1. Ensure this import exists\r\nimport NGOCard from \"@/features/donor/components/NgoCards\";\r\nimport SearchNGOs from \"@/features/donor/components/SearchNGOs\";\r\nimport DonationForm from \"@/features/donor/components/DonationForm\"; // 2. Ensure this import exists\r\nimport { getServerSession } from \"next-auth\";\r\nimport { authOptions } from \"@/app/api/auth/[...nextauth]/route\";\r\nimport { Plus, Inbox, Clock, PackageCheck } from \"lucide-react\";\r\nimport Link from \"next/link\";\r\nimport HandoverButton from \"@/features/donor/components/HandoverButton\";\r\n\r\nexport default async function DonorDashboard({ searchParams }) {\r\n  const session = await getServerSession(authOptions);\r\n  const userId = session?.user?.id; // 3. Get current user ID from session\r\n  const userEmail = session?.user?.email || \"Guest\";\r\n  const initial = userEmail.charAt(0).toUpperCase();\r\n\r\n  await connectDB();\r\n\r\n  // 4. NEW: Fetch this specific donor's listings\r\n  const myDonations = userId\r\n    ? await Listing.find({ donorId: userId })\r\n        .sort({ createdAt: -1 })\r\n        .limit(4)\r\n        .lean()\r\n    : [];\r\n\r\n  // 5. NGO Discovery Logic (Your existing code)\r\n  const query = (await searchParams).query || \"\";\r\n  const filter = { role: \"ngo\", status: \"approved\" };\r\n\r\n  if (query) {\r\n    filter.$or = [\r\n      { \"ngoDetails.ngoName\": { $regex: query, $options: \"i\" } },\r\n      { \"ngoDetails.address\": { $regex: query, $options: \"i\" } },\r\n      { \"ngoDetails.ngoType\": { $regex: query, $options: \"i\" } },\r\n    ];\r\n  }\r\n\r\n  const ngos = await User.find(filter).sort({ createdAt: -1 }).lean();\r\n\r\n  const groupedNgos = ngos.reduce((acc, ngo) => {\r\n    const category = ngo.ngoDetails?.ngoType || \"Other\";\r\n    if (!acc[category]) acc[category] = [];\r\n    acc[category].push(ngo);\r\n    return acc;\r\n  }, {});\r\n\r\n  return (\r\n    <div className='min-h-screen bg-[#FDFDFD] text-slate-900 selection:bg-emerald-100'>\r\n      {/* Navbar */}\r\n      <nav className='sticky top-0 z-30 bg-white/80 backdrop-blur-md border-b border-slate-100'>\r\n        <div className='max-w-7xl mx-auto px-6 h-16 flex items-center justify-between'>\r\n          <div className='flex items-center gap-2.5'>\r\n            <div className='w-8 h-8 bg-emerald-600 rounded-lg flex items-center justify-center shadow-sm'>\r\n              <Plus size={18} className='text-white' />\r\n            </div>\r\n            <span className='font-bold tracking-tight text-lg'>FOODLINK</span>\r\n          </div>\r\n\r\n          <div className='flex items-center gap-6'>\r\n            <SearchNGOs />\r\n            <div\r\n              title={userEmail}\r\n              className='h-9 w-9 bg-emerald-50 border border-emerald-100 rounded-full flex items-center justify-center'\r\n            >\r\n              <span className='text-emerald-700 font-bold text-sm'>\r\n                {initial}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </nav>\r\n\r\n      <main className='max-w-7xl mx-auto px-6 py-10'>\r\n        {/* --- MILESTONE 1.4: DONATION MANAGEMENT SECTION --- */}\r\n        <section className='mb-16 grid grid-cols-1 lg:grid-cols-12 gap-8'>\r\n          <div className='lg:col-span-4'>\r\n            {/* The Form to create new listings */}\r\n            <DonationForm />\r\n          </div>\r\n\r\n          <div className='lg:col-span-8 bg-white border border-slate-100 rounded-2xl p-6 shadow-sm'>\r\n            <div className='flex items-center justify-between mb-6'>\r\n              <h3 className='text-sm font-bold uppercase tracking-widest text-slate-400 flex items-center gap-2'>\r\n                <Clock size={14} /> Your Live Listings\r\n              </h3>\r\n            </div>\r\n\r\n            {/* Displaying the fetched listings */}\r\n            {myDonations.length > 0 ? (\r\n              <div className='grid grid-cols-1 md:grid-cols-2 gap-4'>\r\n                {myDonations.map((item) => (\r\n                  <div\r\n                    key={item._id.toString()}\r\n                    className='p-4 border rounded-xl bg-slate-50/50 border-emerald-600 transition-all'\r\n                  >\r\n                    <div className='flex justify-between items-start mb-2'>\r\n                      {item.status === \"claimed\" && (\r\n                        <div className='mt-3 pt-3 border-t border-slate-100'>\r\n                          <div className='flex items-center gap-2 text-amber-700 mb-3'>\r\n                            <PackageCheck size={14} />\r\n                            <span className='text-[10px] font-bold uppercase'>\r\n                              Claimed by an NGO\r\n                            </span>\r\n                          </div>\r\n\r\n                          <HandoverButton listingId={item._id.toString()} />\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <h4 className='font-bold text-slate-800'>{item.title}</h4>\r\n                    <p className='text-xs text-slate-500 mt-1'>\r\n                      {item.quantity} • {item.foodType}\r\n                    </p>\r\n\r\n                    {item.status === \"claimed\" && (\r\n                      <div className='mt-3 pt-3 border-t border-slate-100 flex items-center gap-2 text-amber-700'>\r\n                        <PackageCheck size={14} />\r\n                        <span className='text-[10px] font-bold'>\r\n                          Claimed by an NGO\r\n                        </span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className='h-40 flex flex-col items-center justify-center text-slate-400 border border-dashed rounded-xl'>\r\n                <p className='text-sm italic'>\r\n                  No active listings. Use the form to post food.\r\n                </p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </section>\r\n\r\n        <div className='h-p\n\n// ✂️ Truncated for AI (original 7420 characters)",
  "src\\app\\(donor)\\layout.js": "import React from 'react'\r\n\r\nfunction layout({children}) {\r\n  return (\r\n    <div>{children}</div>\r\n  )\r\n}\r\n\r\nexport default layout",
  "src\\app\\(organisation)\\layout.js": "import React from 'react'\r\n\r\nfunction layout({children}) {\r\n  return (\r\n    <div>{children}</div>\r\n  )\r\n}\r\n\r\nexport default layout",
  "src\\app\\(organisation)\\organisation\\page.js": "import React from \"react\";\r\nimport connectDB from \"@/lib/db\";\r\nimport Listing from \"@/models/Listing\";\r\nimport { getServerSession } from \"next-auth\";\r\nimport { authOptions } from \"@/app/api/auth/[...nextauth]/route\";\r\nimport { MapPin, Clock, Utensils, PackageCheck, Info } from \"lucide-react\";\r\nimport ClaimButton from \"@/features/organisation/components/ClaimButton\";\r\n\r\nexport default async function NGODashboard({ searchParams }) {\r\n  const session = await getServerSession(authOptions);\r\n  const userId = session?.user?.id;\r\n  const activeTab = (await searchParams).tab || \"available\";\r\n\r\n  await connectDB();\r\n\r\n  let listings = [];\r\n\r\n  if (activeTab === \"available\") {\r\n    // Fetch only available and unexpired food\r\n    listings = await Listing.find({\r\n      status: \"available\",\r\n      expiryTime: { $gt: new Date() }\r\n    })\r\n    .populate(\"donorId\", \"name email donorDetails\")\r\n    .sort({ createdAt: -1 })\r\n    .lean();\r\n  } else {\r\n    // Fetch food claimed by THIS NGO\r\n    listings = await Listing.find({\r\n      claimedBy: userId,\r\n      status: \"claimed\"\r\n    })\r\n    .populate(\"donorId\", \"name email donorDetails\")\r\n    .sort({ updatedAt: -1 })\r\n    .lean();\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-[#F8FAFC] p-6\">\r\n      <div className=\"max-w-6xl mx-auto\">\r\n        <header className=\"mb-8\">\r\n          <h1 className=\"text-3xl font-extrabold text-slate-900\">NGO Operations</h1>\r\n          <p className=\"text-slate-500\">Manage your food collection and distributions.</p>\r\n        </header>\r\n\r\n        {/* --- Tab Navigation --- */}\r\n        <div className=\"flex gap-4 mb-8 border-b border-slate-200\">\r\n          <a \r\n            href=\"?tab=available\"\r\n            className={`pb-4 px-2 font-bold text-sm transition-all ${activeTab === 'available' ? 'border-b-2 border-emerald-600 text-emerald-600' : 'text-slate-400 hover:text-slate-600'}`}\r\n          >\r\n            Available Feed\r\n          </a>\r\n          <a \r\n            href=\"?tab=my-pickups\"\r\n            className={`pb-4 px-2 font-bold text-sm transition-all ${activeTab === 'my-pickups' ? 'border-b-2 border-emerald-600 text-emerald-600' : 'text-slate-400 hover:text-slate-600'}`}\r\n          >\r\n            My Pickups {activeTab !== 'my-pickups' && listings.length > 0 && <span className=\"ml-1 bg-emerald-100 text-emerald-600 px-1.5 py-0.5 rounded-full text-[10px]\">!</span>}\r\n          </a>\r\n        </div>\r\n\r\n        {/* --- Food Cards Grid --- */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n          {listings.map((item) => (\r\n            <div key={item._id.toString()} className=\"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden\">\r\n              <div className=\"p-5\">\r\n                <div className=\"flex justify-between items-center mb-4\">\r\n                  <span className=\"bg-slate-100 text-slate-600 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider\">\r\n                    {item.foodType}\r\n                  </span>\r\n                  {activeTab === 'my-pickups' && (\r\n                    <span className=\"flex items-center gap-1 text-emerald-600 text-[10px] font-bold uppercase\">\r\n                      <PackageCheck size={14} /> Ready for Pickup\r\n                    </span>\r\n                  )}\r\n                </div>\r\n\r\n                <h3 className=\"text-lg font-bold text-slate-800\">{item.title}</h3>\r\n                <p className=\"text-xs text-slate-500 mt-1 mb-4\">{item.quantity}</p>\r\n                \r\n                <div className=\"space-y-3 bg-slate-50 p-3 rounded-xl mb-4\">\r\n                  <div className=\"flex items-start gap-2 text-slate-600\">\r\n                    <MapPin size={14} className=\"mt-1 flex-shrink-0\" />\r\n                    <span className=\"text-xs\">{item.pickupAddress}</span>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2 text-slate-600\">\r\n                    <Clock size={14} />\r\n                    <span className=\"text-xs\">Expires: {new Date(item.expiryTime).toLocaleTimeString()}</span>\r\n                  </div>\r\n                </div>\r\n\r\n                {activeTab === 'available' ? (\r\n                  <ClaimButton listingId={item._id.toString()} />\r\n                ) : (\r\n                  <div className=\"space-y-3\">\r\n                     <div className=\"flex items-center justify-between p-2 bg-emerald-50 rounded-lg border border-emerald-100\">\r\n                        <span className=\"text-[10px] font-bold text-emerald-700\">CONTACT DONOR</span>\r\n                        <span className=\"text-[10px] font-medium\">{item.donorId?.donorDetails?.phoneNumber || \"N/A\"}</span>\r\n                     </div>\r\n                     <button className=\"w-full py-2 bg-slate-900 text-white text-xs font-bold rounded-lg hover:bg-slate-800\">\r\n                        Directions (Maps)\r\n                     </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {listings.length === 0 && (\r\n          <div className=\"text-center py-20\">\r\n            <Info className=\"mx-auto text-slate-300 mb-2\" />\r\n            <p className=\"text-slate-400 text-sm\">No items found in this category.</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}",
  "src\\app\\api\\auth\\[...nextauth]\\route.js": "import NextAuth from \"next-auth\";\r\nimport CredentialsProvider from \"next-auth/providers/credentials\";\r\nimport connectDB from \"@/lib/db\";\r\nimport User from \"@/models/User\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nexport const authOptions = {\r\n  session: {\r\n    strategy: \"jwt\",\r\n    maxAge: 30 * 24 * 60 * 60, // 30 days\r\n  },\r\n  providers: [\r\n    CredentialsProvider({\r\n      name: \"credentials\",\r\n      credentials: {},\r\n      async authorize(credentials) {\r\n        try {\r\n          await connectDB();\r\n          if (!credentials?.email || !credentials?.password) return null;\r\n\r\n          const user = await User.findOne({\r\n            email: credentials.email.toLowerCase(),\r\n          }).lean();\r\n\r\n          if (!user) return null;\r\n\r\n          const isValid = await bcrypt.compare(credentials.password, user.password);\r\n          if (!isValid) return null;\r\n\r\n          return {\r\n            id: user._id.toString(),\r\n            email: user.email,\r\n            name: user.name || null,\r\n            role: user.role,\r\n          };\r\n        } catch (err) {\r\n          console.error(\"Authorize crashed:\", err);\r\n          return null;\r\n        }\r\n      },\r\n    }),\r\n  ],\r\n  callbacks: {\r\n    async jwt({ token, user }) {\r\n      if (user) {\r\n        token.role = user.role;\r\n        token.id = user.id; // Persists ID to token\r\n      }\r\n      return token;\r\n    },\r\n    async session({ session, token }) {\r\n      if (session.user) {\r\n        session.user.role = token.role;\r\n        session.user.id = token.id; // Persists ID to session\r\n      }\r\n      return session;\r\n    },\r\n  }, // Fixed closing brace for callbacks\r\n  pages: {\r\n    signIn: \"/log-in\",\r\n    error: \"/log-in\",\r\n  },\r\n  secret: process.env.NEXTAUTH_SECRET,\r\n};\r\n\r\nconst handler = NextAuth(authOptions);\r\nexport { handler as GET, handler as POST };",
  "src\\app\\globals.css": "@import \"tailwindcss\";\n\n:root {\n  --background: #ffffff;\n  --foreground: #171717;\n}\n\n@theme inline {\n  --color-background: var(--background);\n  --color-foreground: var(--foreground);\n  --font-sans: var(--font-geist-sans);\n  --font-mono: var(--font-geist-mono);\n}\n\n@media (prefers-color-scheme: dark) {\n  :root {\n    --background: #0a0a0a;\n    --foreground: #ededed;\n  }\n}\n\nbody {\n  background: var(--background);\n  color: var(--foreground);\n  font-family: Arial, Helvetica, sans-serif;\n}\n",
  "src\\app\\layout.js": "import { Geist, Geist_Mono } from \"next/font/google\";\nimport \"./globals.css\";\nimport Providers from \"@/components/Providers\";\n\nconst geistSans = Geist({\n  variable: \"--font-geist-sans\",\n  subsets: [\"latin\"],\n});\n\nconst geistMono = Geist_Mono({\n  variable: \"--font-geist-mono\",\n  subsets: [\"latin\"],\n});\n\nexport const metadata = {\n  title: \"Create Next App\",\n  description: \"Generated by create next app\",\n};\n\nexport default function RootLayout({ children }) {\n  return (\n    <html lang=\"en\">\n      <body\n        className={`${geistSans.variable} ${geistMono.variable} antialiased`}\n      >\n<Providers>\n        {children}\n</Providers>\n      </body>\n    </html>\n  );\n}\n",
  "src\\app\\page.js": "\"use client\";\nimport React from 'react';\nimport Link from 'next/link';\nimport Navbar from '@/components/Navbar';\nimport Footer from '@/components/Footer';\nimport Hero from '@/components/Hero';\n\nexport default function LandingPage() {\n  return (\n    <div className=\"min-h-screen bg-slate-50 font-sans text-slate-900\">\n      <Navbar/>\n     {/* Hero Section*/}\n     <Hero/>\n\n      {/* --- Statistics / Impact Section --- */}\n      <section id=\"impact\" className=\"py-16 px-8\">\n        <div className=\"max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8 text-center\">\n          <div className=\"p-8 bg-white rounded-2xl shadow-sm border border-slate-100\">\n            <h3 className=\"text-4xl font-bold text-emerald-600 mb-2\">500+</h3>\n            <p className=\"text-slate-500 font-medium uppercase tracking-wide\">Meals Delivered</p>\n          </div>\n          <div className=\"p-8 bg-white rounded-2xl shadow-sm border border-slate-100\">\n            <h3 className=\"text-4xl font-bold text-emerald-600 mb-2\">45</h3>\n            <p className=\"text-slate-500 font-medium uppercase tracking-wide\">Partnered NGOs</p>\n          </div>\n          <div className=\"p-8 bg-white rounded-2xl shadow-sm border border-slate-100\">\n            <h3 className=\"text-4xl font-bold text-emerald-600 mb-2\">1.2 Tons</h3>\n            <p className=\"text-slate-500 font-medium uppercase tracking-wide\">Waste Prevented</p>\n          </div>\n        </div>\n      </section>\n\n      {/* --- Features Section --- */}\n      <section id=\"how-it-works\" className=\"py-20 px-8 bg-white\">\n        <div className=\"max-w-6xl mx-auto text-center mb-16\">\n          <h2 className=\"text-3xl font-bold mb-4\">Our Real-Time Platform Features</h2>\n          <div className=\"w-20 h-1 bg-emerald-500 mx-auto\"></div>\n        </div>\n        \n        <div className=\"max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-12\">\n          {[\n            { title: \"Smart Matching\", desc: \"Location-based matching between nearby donors and NGOs for fast pickup.\" },\n            { title: \"Real-time Tracking\", desc: \"Live updates on food availability, quantity, and expiry times.\" },\n            { title: \"Verified Partners\", desc: \"Security through digital verification of all donors and volunteer NGOs.\" }\n          ].map((feature, i) => (\n            <div key={i} className=\"group hover:transform hover:-translate-y-2 transition-all duration-300\">\n              <div className=\"w-16 h-16 bg-emerald-100 text-emerald-600 rounded-2xl flex items-center justify-center mb-6 text-2xl mx-auto group-hover:bg-emerald-600 group-hover:text-white transition-colors\">\n                {i + 1}\n              </div>\n              <h4 className=\"text-xl font-bold mb-3\">{feature.title}</h4>\n              <p className=\"text-slate-600 leading-relaxed\">{feature.desc}</p>\n            </div>\n          ))}\n        </div>\n      </section>\n\n    <Footer/>\n    </div>\n  );\n}",
  "src\\app\\test-session\\page.js": "\"use client\";\r\nimport { useSession } from \"next-auth/react\";\r\n\r\nexport default function DebugSession() {\r\n  const { data: session, status } = useSession();\r\n\r\n  if (status === \"loading\") return <div>Loading session...</div>;\r\n\r\n  return (\r\n    <div className=\"p-8\">\r\n      <h1>Session Debug</h1>\r\n      <pre className=\"bg-gray-100 p-4 rounded overflow-auto\">\r\n        {JSON.stringify({ status, session }, null, 2)}\r\n      </pre>\r\n    </div>\r\n  );\r\n}",
  "src\\components\\Footer.js": "import React from 'react'\r\n\r\nfunction Footer() {\r\n  return (\r\n   <>\r\n     {/* --- Footer --- */}\r\n      <footer className=\"bg-slate-900 text-slate-400 py-12 px-8\">\r\n        <div className=\"max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center\">\r\n          <div className=\"mb-6 md:mb-0\">\r\n            <div className=\"text-2xl font-bold text-white mb-2\">FoodLink</div>\r\n            <p>VVM's SHREE DAMODAR COLLEGE</p>\r\n          </div>\r\n          <div className=\"text-sm\">\r\n            © 2026 Team ThunderBolts. All rights reserved.\r\n          </div>\r\n        </div>\r\n      </footer>\r\n   </>\r\n  )\r\n}\r\n\r\nexport default Footer",
  "src\\components\\Hero.js": "import React from 'react'\r\n\r\nfunction Hero() {\r\n  return (\r\n    <>\r\n    {/* --- Hero Section --- */}\r\n      <header className=\"px-8 py-20 bg-emerald-600 text-white text-center\">\r\n        <div className=\"max-w-4xl mx-auto\">\r\n          <h1 className=\"text-5xl font-extrabold mb-6 leading-tight\">\r\n            Connecting Surplus Food to Those in Need\r\n          </h1>\r\n          <p className=\"text-xl mb-10 opacity-90\">\r\n            Real-time food redistribution to reduce waste and fight hunger in our community.\r\n          </p>\r\n          <div className=\"flex flex-wrap justify-center gap-4\">\r\n            <button className=\"px-8 py-4 bg-white text-emerald-600 text-lg font-bold rounded-xl hover:bg-slate-100 transition shadow-lg\">\r\n              NGO: Find Food Nearby\r\n            </button>\r\n            <button className=\"px-8 py-4 bg-emerald-800 text-white text-lg font-bold rounded-xl hover:bg-emerald-900 transition shadow-lg\">\r\n              Donor: List Surplus Food\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </header>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Hero",
  "src\\components\\Navbar.js": "import Link from 'next/link'\r\nimport React from 'react'\r\n\r\nfunction Navbar() {\r\n  return (\r\n    <>\r\n    {/* --- Navigation --- */}\r\n      <nav className=\"flex items-center justify-between px-8 py-6 bg-white shadow-sm\">\r\n        <div className=\"text-2xl font-bold text-emerald-600\">FoodLink</div>\r\n        <div className=\"hidden md:flex space-x-8 font-medium\">\r\n          <Link href=\"#how-it-works\" className=\"hover:text-emerald-600 transition\">How it Works</Link>\r\n          <Link href=\"#impact\" className=\"hover:text-emerald-600 transition\">Our Impact</Link>\r\n          <Link href=\"#listings\" className=\"hover:text-emerald-600 transition\">Live Listings</Link>\r\n        </div>\r\n        <div className=\"flex space-x-4\">\r\n            <Link href={'/log-in'}>\r\n          <button className=\"px-5 py-2 text-emerald-600 font-semibold border border-emerald-600 rounded-lg hover:bg-emerald-50 transition\">\r\n            Login\r\n          </button>\r\n            </Link>\r\n          {/* <button className=\"px-5 py-2 bg-emerald-600 text-white font-semibold rounded-lg hover:bg-emerald-700 shadow-md transition\">\r\n            Join as Donor\r\n            </button> */}\r\n        </div>\r\n      </nav>\r\n            </>\r\n  )\r\n}\r\n\r\nexport default Navbar",
  "src\\components\\Providers.js": "\"use client\";\r\nimport { SessionProvider } from \"next-auth/react\";\r\n\r\nexport default function Providers({ children }) {\r\n  return <SessionProvider>{children}</SessionProvider>;\r\n}",
  "src\\features\\auth\\actions.js": "\"use server\";\r\nimport connectDB from \"@/lib/db\";\r\nimport User from \"@/models/User\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nexport async function registerUser(payload) {\r\n  try {\r\n    await connectDB();\r\n    const { email, password, role, ...details } = payload;\r\n    const normalizedEmail = email.toLowerCase();\r\n\r\n    const existingUser = await User.findOne({ email: normalizedEmail });\r\n    if (existingUser) return { error: \"User already exists\" };\r\n\r\n    const salt = await bcrypt.genSalt(12);\r\n    const hashedPassword = await bcrypt.hash(password, salt);\r\n\r\n    const userData = {\r\n      name: role === 'ngo' ? details.ngoName : details.name,\r\n      email: normalizedEmail,\r\n      password: hashedPassword,\r\n      role,\r\n      status: \"pending\", // Default to pending for verification\r\n    };\r\n\r\n    if (role === 'ngo') {\r\n      userData.ngoDetails = details;\r\n    } else {\r\n      userData.donorDetails = details;\r\n    }\r\n\r\n    const newUser = new User(userData);\r\n    await newUser.save();\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"Registration Error:\", error);\r\n    return { error: \"Registration failed. Check all fields.\" };\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\"use server\";\r\nimport connectDB from \"@/lib/db\";\r\nimport User from \"@/models/User\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nexport async function registerUser(payload) {\r\n  try {\r\n    await connectDB();\r\n    const { email, password, role, ...details } = payload;\r\n    const normalizedEmail = email.toLowerCase();\r\n\r\n    const existingUser = await User.findOne({ email: normalizedEmail });\r\n    if (existingUser) return { error: \"User already exists\" };\r\n\r\n    const salt = await bcrypt.genSalt(12);\r\n    const hashedPassword = await bcrypt.hash(password, salt);\r\n\r\n    const userData = {\r\n      name: role === 'ngo' ? details.ngoName : details.name,\r\n      email: normalizedEmail,\r\n      password: hashedPassword,\r\n      role,\r\n      status: \"pending\", // Default to pending for verification\r\n    };\r\n\r\n    if (role === 'ngo') {\r\n      userData.ngoDetails = details;\r\n    } else {\r\n      userData.donorDetails = details;\r\n    }\r\n\r\n    const newUser = new User(userData);\r\n    await newUser.save();\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"Registration Error:\", error);\r\n    return { error: \"Registration failed. Check all fields.\" };\r\n  }\r\n}",
  "src\\features\\donor\\actions.js": "\"use server\";\r\n\r\nimport connectDB from \"@/lib/db\";\r\nimport Listing from \"@/models/Listing\";\r\nimport { getServerSession } from \"next-auth\";\r\nimport { authOptions } from \"@/app/api/auth/[...nextauth]/route\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\nexport async function createListing(prevState, formData) {\r\n  const session = await getServerSession(authOptions);\r\n  if (!session) return { error: \"Unauthorized\" };\r\n\r\n  await connectDB();\r\n\r\n  // 1. Extract exactly what the form sends\r\n  const title = formData.get(\"title\");\r\n  const foodType = formData.get(\"foodType\");\r\n  const quantity = formData.get(\"quantity\");\r\n  const expiryTime = formData.get(\"expiryTime\");\r\n  const pickupAddress = formData.get(\"pickupAddress\"); // Ensure this matches name=\"pickupAddress\" in form\r\n\r\n  // 2. Comprehensive Validation Check\r\n  if (!title || !foodType || !quantity || !expiryTime || !pickupAddress) {\r\n    return { error: \"Missing fields. Please check Title, Type, Quantity, Expiry, and Address.\" };\r\n  }\r\n\r\n  try {\r\n    await Listing.create({\r\n      donorId: session.user.id,\r\n      title,\r\n      description: title, // Using title as description since form doesn't have a desc field\r\n      foodType,\r\n      quantity,\r\n      pickupAddress,\r\n      expiryTime: new Date(expiryTime),\r\n      status: \"available\",\r\n    });\r\n\r\n    revalidatePath(\"/donor\");\r\n    return { success: \"Donation posted successfully!\" };\r\n  } catch (error) {\r\n    // 3. Log the ACTUAL error to your console so you can see the field name failing\r\n    console.error(\"MONGODB_SAVE_ERROR:\", error.message);\r\n    return { error: `Database Error: ${error.message}` };\r\n  }\r\n}\r\n\r\nexport async function completeListing(listingId) {\r\n  const session = await getServerSession(authOptions);\r\n\r\n  // Security: Only the donor should be able to mark as completed\r\n  if (!session || session.user.role !== \"donor\") {\r\n    return { error: \"Unauthorized.\" };\r\n  }\r\n\r\n  await connectDB();\r\n\r\n  try {\r\n    const updatedListing = await Listing.findOneAndUpdate(\r\n      { \r\n        _id: listingId, \r\n        donorId: session.user.id, // Must be the owner\r\n        status: \"claimed\"         // Can only complete if it was claimed\r\n      },\r\n      { $set: { status: \"completed\" } },\r\n      { new: true }\r\n    );\r\n\r\n    if (!updatedListing) {\r\n      return { error: \"Listing not found or not in a 'claimed' state.\" };\r\n    }\r\n\r\n    revalidatePath(\"/donor\");\r\n    revalidatePath(\"/organisation\");\r\n    return { success: \"Handover confirmed! Impact recorded.\" };\r\n  } catch (error) {\r\n    return { error: \"Failed to complete the transaction.\" };\r\n  }\r\n}",
  "src\\features\\donor\\components\\DonationForm.js": "\"use client\";\r\n\r\nimport { useActionState } from \"react\";\r\nimport { createListing } from \"@/features/donor/actions\";\r\n\r\nexport default function DonationForm() {\r\n  // state will hold the return value from our server action (success or error)\r\n  const [state, formAction, isPending] = useActionState(createListing, null);\r\n\r\n  return (\r\n    <div className=\"max-w-2xl mx-auto p-6 bg-white rounded-xl shadow-md border border-gray-100\">\r\n      <h2 className=\"text-2xl font-bold mb-6 text-gray-800\">Post Surplus Food</h2>\r\n      \r\n    <form \r\n      key={state?.success ? \"success\" : \"reset\"} \r\n      action={formAction} \r\n      className=\"space-y-4\"\r\n    >\r\n        {/* Title */}\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700\">Item Name</label>\r\n          <input\r\n            name=\"title\"\r\n            placeholder=\"e.g., Dal Tadka and Rice\"\r\n            className=\"w-full p-2 mt-1 border rounded-lg focus:ring-2 focus:ring-green-500 outline-none\"\r\n            required\r\n          />\r\n        </div>\r\n\r\n        {/* Type & Quantity */}\r\n        <div className=\"grid grid-cols-2 gap-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700\">Food Type</label>\r\n            <select name=\"foodType\" className=\"w-full p-2 mt-1 border rounded-lg bg-white\">\r\n              <option value=\"Cooked\">Cooked Meal</option>\r\n              <option value=\"Raw\">Raw Materials</option>\r\n              <option value=\"Packaged\">Packaged/Canned</option>\r\n            </select>\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700\">Quantity</label>\r\n            <input\r\n              name=\"quantity\"\r\n              placeholder=\"e.g., 50 plates / 10kg\"\r\n              className=\"w-full p-2 mt-1 border rounded-lg\"\r\n              required\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Expiry Time - Crucial for Real-Time logic */}\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700\">Best Before (Expiry Time)</label>\r\n          <input\r\n            type=\"datetime-local\"\r\n            name=\"expiryTime\"\r\n            className=\"w-full p-2 mt-1 border rounded-lg\"\r\n            required\r\n          />\r\n          <p className=\"text-xs text-gray-500 mt-1\">When should this be removed from the list?</p>\r\n        </div>\r\n\r\n        {/* Pickup Address */}\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700\">Pickup Location</label>\r\n          <textarea\r\n            name=\"pickupAddress\"\r\n            rows=\"2\"\r\n            placeholder=\"Enter the full address for pickup\"\r\n            className=\"w-full p-2 mt-1 border rounded-lg\"\r\n            required\r\n          ></textarea>\r\n        </div>\r\n\r\n        {/* Feedback Messages */}\r\n        {state?.error && <p className=\"text-red-500 text-sm bg-red-50 p-2 rounded\">{state.error}</p>}\r\n        {state?.success && <p className=\"text-green-600 text-sm bg-green-50 p-2 rounded\">{state.success}</p>}\r\n\r\n        {/* Submit Button */}\r\n        <button\r\n          type=\"submit\"\r\n          disabled={isPending}\r\n          className={`w-full py-3 rounded-lg font-semibold text-white transition-all ${\r\n            isPending ? \"bg-gray-400\" : \"bg-green-600 hover:bg-green-700 shadow-lg\"\r\n          }`}\r\n        >\r\n          {isPending ? \"Posting...\" : \"Broadcast to Nearby NGOs\"}\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n}",
  "src\\features\\donor\\components\\HandoverButton.js": "\"use client\";\r\n\r\nimport { useTransition } from \"react\";\r\nimport { completeListing } from \"@/features/donor/actions\";\r\n\r\nexport default function HandoverButton({ listingId }) {\r\n  const [isPending, startTransition] = useTransition();\r\n\r\n  const handleComplete = () => {\r\n    if (confirm(\"Has the NGO collected this food?\")) {\r\n      startTransition(async () => {\r\n        await completeListing(listingId);\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <button\r\n      onClick={handleComplete}\r\n      disabled={isPending}\r\n      className={`w-full py-2 rounded-lg text-xs font-bold transition-all ${\r\n        isPending \r\n          ? \"bg-slate-100 text-slate-400\" \r\n          : \"bg-emerald-600 text-white hover:bg-emerald-700 shadow-sm\"\r\n      }`}\r\n    >\r\n      {isPending ? \"Updating...\" : \"Confirm Handover\"}\r\n    </button>\r\n  );\r\n}",
  "src\\features\\donor\\components\\NgoCards.js": "import React from \"react\";\r\nimport { MapPin, Users, ArrowUpRight, CheckCircle2 } from \"lucide-react\";\r\n\r\nconst NGOCard = ({ ngo }) => {\r\n  const { ngoDetails } = ngo;\r\n\r\n  return (\r\n    <div className='group relative flex flex-col'>\r\n      {/* The main card container */}\r\n      <div className='bg-white border rounded-2xl p-5 border-emerald-600 hover:shadow-[0_20px_40px_-15px_rgba(0,0,0,0.05)] transition-all duration-500'>\r\n        <div className='flex justify-between items-start mb-6'>\r\n          <div className='flex items-center gap-3'>\r\n            <div className='h-10 w-10 rounded-full bg-slate-50 flex items-center justify-center group-hover:bg-emerald-50 transition-colors'>\r\n              <span className='text-xs font-bold text-slate-400 group-hover:text-emerald-600'>\r\n                {ngoDetails.ngoName?.substring(0, 2).toUpperCase()}\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <div className='flex items-center gap-1.5'>\r\n                <h3 className='font-bold text-slate-900 leading-none'>\r\n                  {ngoDetails.ngoName}\r\n                </h3>\r\n                <CheckCircle2 size={14} className='text-emerald-500' />\r\n              </div>\r\n              <p className='text-[10px] text-slate-400 font-bold uppercase tracking-tighter mt-1'>\r\n                {ngoDetails.registrationType}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className='space-y-4 mb-6'>\r\n          <div className='flex items-center gap-2.5 text-slate-500'>\r\n            <MapPin size={14} className='text-slate-300' />\r\n            <span className='text-xs font-medium truncate'>\r\n              {ngoDetails.address}\r\n            </span>\r\n          </div>\r\n          <div className='flex items-center gap-2.5 text-slate-500'>\r\n            <Users size={14} className='text-slate-300' />\r\n            <span className='text-xs font-medium'>\r\n              Supports {ngoDetails.beneficiaryCapacity} lives daily\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Decorative background element for minimal depth */}\r\n      <div className='absolute inset-0 bg-emerald-600 rounded-2xl -z-10 translate-y-1 opacity-0 group-hover:opacity-10 group-hover:translate-y-2 transition-all duration-500'></div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NGOCard;\r\n",
  "src\\features\\donor\\components\\SearchNGOs.js": "\"use client\";\r\n\r\nimport { Search } from 'lucide-react';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport { useTransition } from 'react';\r\n\r\nexport default function SearchNGOs() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const [isPending, startTransition] = useTransition();\r\n\r\n  function handleSearch(term) {\r\n    const params = new URLSearchParams(searchParams);\r\n    if (term) {\r\n      params.set('query', term);\r\n    } else {\r\n      params.delete('query');\r\n    }\r\n\r\n    // startTransition keeps the UI responsive while the server re-filters the data\r\n    startTransition(() => {\r\n      router.replace(`/donor?${params.toString()}`);\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div className=\"relative group w-full md:w-80\">\r\n      <Search \r\n        className={`absolute left-3 top-1/2 -translate-y-1/2 transition-colors ${\r\n          isPending ? \"text-emerald-500 animate-pulse\" : \"text-slate-400 group-focus-within:text-emerald-600\"\r\n        }`} \r\n        size={16} \r\n      />\r\n      <input \r\n        type=\"text\" \r\n        defaultValue={searchParams.get('query')?.toString()}\r\n        onChange={(e) => handleSearch(e.target.value)}\r\n        placeholder=\"Find an NGO...\" \r\n        className=\"pl-10 pr-4 py-2 bg-slate-100/50 border-transparent border focus:bg-white focus:border-emerald-500 rounded-full text-sm w-full transition-all outline-none\"\r\n      />\r\n    </div>\r\n  );\r\n}",
  "src\\features\\organisation\\actions.js": "\"use server\";\r\n\r\nimport connectDB from \"@/lib/db\";\r\nimport Listing from \"@/models/Listing\";\r\nimport { getServerSession } from \"next-auth\";\r\nimport { authOptions } from \"@/app/api/auth/[...nextauth]/route\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\nexport async function claimListing(listingId) {\r\n  const session = await getServerSession(authOptions);\r\n\r\n  // 1. Security Check\r\n  if (!session || session.user.role !== \"ngo\") {\r\n    return { error: \"Only verified NGOs can claim food.\" };\r\n  }\r\n\r\n  await connectDB();\r\n\r\n  try {\r\n    // 2. Atomic Update\r\n    // We search for the ID AND ensure it is still \"available\" \r\n    // This prevents \"Double Claiming\"\r\n    const updatedListing = await Listing.findOneAndUpdate(\r\n      { \r\n        _id: listingId, \r\n        status: \"available\" \r\n      },\r\n      { \r\n        $set: { \r\n          status: \"claimed\", \r\n          claimedBy: session.user.id \r\n        } \r\n      },\r\n      { new: true } // returns the updated document\r\n    );\r\n\r\n    if (!updatedListing) {\r\n      return { error: \"Too late! This food was just claimed by someone else or is no longer available.\" };\r\n    }\r\n\r\n    // 3. Refresh the dashboards\r\n    revalidatePath(\"/organisation\"); // Refresh NGO feed\r\n    revalidatePath(\"/donor\");        // Refresh Donor's \"Live Listings\"\r\n\r\n    return { success: \"Food claimed successfully! Please proceed for pickup.\" };\r\n  } catch (error) {\r\n    console.error(\"CLAIM_ERROR:\", error);\r\n    return { error: \"Failed to claim listing. Please try again.\" };\r\n  }\r\n}",
  "src\\features\\organisation\\components\\ClaimButton.js": "\"use client\";\r\n\r\nimport { useState, useTransition } from \"react\";\r\nimport { claimListing } from \"../actions\";\r\n\r\nexport default function ClaimButton({ listingId }) {\r\n  const [isPending, startTransition] = useTransition();\r\n  const [message, setMessage] = useState({ type: \"\", text: \"\" });\r\n\r\n  const handleClaim = () => {\r\n    setMessage({ type: \"\", text: \"\" });\r\n\r\n    startTransition(async () => {\r\n      const result = await claimListing(listingId);\r\n\r\n      if (result.error) {\r\n        setMessage({ type: \"error\", text: result.error });\r\n      } else {\r\n        setMessage({ type: \"success\", text: result.success });\r\n      }\r\n    });\r\n  };\r\n\r\n  if (message.type === \"success\") {\r\n    return (\r\n      <div className=\"w-full py-2 px-4 bg-green-50 text-green-700 text-xs font-bold rounded-lg border border-green-100 text-center\">\r\n        ✓ {message.text}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <button\r\n        onClick={handleClaim}\r\n        disabled={isPending}\r\n        className={`w-full py-3 rounded-xl font-bold text-sm transition-all ${\r\n          isPending \r\n            ? \"bg-slate-100 text-slate-400 cursor-not-allowed\" \r\n            : \"bg-emerald-600 text-white hover:bg-emerald-700 active:scale-95 shadow-sm shadow-emerald-100\"\r\n        }`}\r\n      >\r\n        {isPending ? \"Processing...\" : \"Claim Food Now\"}\r\n      </button>\r\n\r\n      {message.type === \"error\" && (\r\n        <p className=\"text-[10px] text-red-500 font-medium text-center bg-red-50 p-1 rounded\">\r\n          {message.text}\r\n        </p>\r\n      )}\r\n    </div>\r\n  );\r\n}",
  "src\\lib\\db.js": "import mongoose from \"mongoose\";\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\"Please define the MONGODB_URI environment variable\");\r\n}\r\n\r\nlet cached = global.mongoose || { conn: null, promise: null };\r\n\r\nasync function connectDB() {\r\n  if (cached.conn) return cached.conn;\r\n\r\nif (!cached.promise) {\r\n  console.log(\"Creating new MongoDB connection...\");\r\n  cached.promise = mongoose.connect(MONGODB_URI).then((m) => {\r\n    console.log(\"MongoDB Connected Successfully\");\r\n    return m;\r\n  });\r\n}\r\n  \r\n  cached.conn = await cached.promise;\r\n  return cached.conn;\r\n}\r\n\r\nexport default connectDB;",
  "src\\middleware.js": "import { withAuth } from \"next-auth/middleware\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\nexport default withAuth(\r\n  function middleware(req) {\r\n    const token = req.nextauth.token;\r\n    const path = req.nextUrl.pathname; // Fixed: Use nextUrl, not nextrole\r\n\r\n    // 1. Prevent Donors from seeing NGO pages\r\n    if (path.startsWith(\"/organisation\") && token?.role !== \"ngo\") {\r\n      return NextResponse.redirect(new URL(\"/donor\", req.url));\r\n    }\r\n\r\n    // 2. Prevent NGOs from seeing Donor pages\r\n    if (path.startsWith(\"/donor\") && token?.role !== \"donor\") {\r\n      return NextResponse.redirect(new URL(\"/organisation\", req.url));\r\n    }\r\n  },\r\n  {\r\n    callbacks: {\r\n      // The middleware only runs if authorized returns true\r\n      authorized: ({ token }) => !!token,\r\n    },\r\n  }\r\n);\r\n\r\n// CRITICAL: This config determines where the middleware runs\r\nexport const config = { \r\n  matcher: [\r\n    /*\r\n     * Match only the dashboard routes. \r\n     * Do NOT match /log-in, /register, or /api routes.\r\n     */\r\n    \"/donor/:path*\", \r\n    \"/organisation/:path*\"\r\n  ] \r\n};",
  "src\\models\\Listing.js": "import mongoose from \"mongoose\";\r\n\r\nconst ListingSchema = new mongoose.Schema({\r\n  // Reference to the Donor (User model)\r\n  donorId: { \r\n    type: mongoose.Schema.Types.ObjectId, \r\n    ref: \"User\", \r\n    required: true \r\n  },\r\n  \r\n  // Basic Food Info\r\n  title: { \r\n    type: String, \r\n    required: [true, \"Please provide a title for the donation\"],\r\n    trim: true \r\n  },\r\n  description: { \r\n    type: String, \r\n    required: [true, \"Please describe the food items\"] \r\n  },\r\n  foodType: { \r\n    type: String, \r\n    enum: [\"Cooked\", \"Raw\", \"Packaged\", \"Other\"], \r\n    required: true \r\n  },\r\n  \r\n  // Quantity & Logistics\r\n  quantity: { \r\n    type: String, \r\n    required: [true, \"Please specify quantity (e.g., '10 kg' or '20 plates')\"] \r\n  },\r\n  pickupAddress: { \r\n    type: String, \r\n    required: [true, \"Pickup address is required\"] \r\n  },\r\n  \r\n  // Safety Timestamps\r\n  cookedTime: { \r\n    type: Date \r\n  }, \r\n  expiryTime: { \r\n    type: Date, \r\n    required: [true, \"Expiry time is critical for food safety\"] \r\n  },\r\n  \r\n  // Transaction State\r\n  status: { \r\n    type: String, \r\n    enum: [\"available\", \"claimed\", \"completed\", \"expired\"], \r\n    default: \"available\" \r\n  },\r\n  \r\n  // Reference to the NGO who claims the food\r\n  claimedBy: { \r\n    type: mongoose.Schema.Types.ObjectId, \r\n    ref: \"User\",\r\n    default: null\r\n  }\r\n}, { \r\n  timestamps: true // Automatically creates 'createdAt' and 'updatedAt'\r\n});\r\n\r\n// Create an index on status and expiryTime for faster queries on the NGO feed\r\nListingSchema.index({ status: 1, expiryTime: 1 });\r\n\r\nexport default mongoose.models.Listing || mongoose.model(\"Listing\", ListingSchema);",
  "src\\models\\User.js": "import mongoose from \"mongoose\";\r\n\r\nconst UserSchema = new mongoose.Schema({\r\n  name: { type: String, required: true }, // General Name or Admin Name\r\n  email: { type: String, unique: true, required: true },\r\n  password: { type: String, required: true },\r\n  role: { type: String, enum: [\"donor\", \"ngo\"], required: true },\r\n  status: { type: String, enum: [\"pending\", \"approved\", \"rejected\"], default: \"pending\" },\r\n  \r\n  // Specific Data for Donors\r\n  donorDetails: {\r\n    donorType: { type: String, enum: [\"Individual\", \"Restaurant\", \"Hotel\", \"Caterer\", \"Other\"] },\r\n    address: String,\r\n    phoneNumber: String,\r\n    businessLicense: String, // Optional FSSAI or business ID\r\n  },\r\n\r\n  // Specific Data for NGOs\r\n  ngoDetails: {\r\n    ngoName: String,\r\n    ngoType: { type: String, enum: [\"Food Bank\", \"Orphanage\", \"Shelter Home\", \"Community Kitchen\", \"Other\"] },\r\n    registrationType: { type: String, enum: [\"Society\", \"Trust\", \"Section 8 Company\", \"Other\"] },\r\n    registrationNumber: String,\r\n    ngoDarpanId: String,\r\n    reg12A: String,\r\n    reg80G: String,\r\n    fcraNumber: String,\r\n    address: String,\r\n    pinCode: String,\r\n    phoneNumber: String,\r\n    beneficiaryCapacity: Number,\r\n    documents: [String], // Array of URLs (e.g., from Cloudinary/AWS S3)\r\n  }\r\n}, { timestamps: true });\r\n\r\nexport default mongoose.models.User || mongoose.model(\"User\", UserSchema);"
}